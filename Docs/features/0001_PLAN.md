# FulQrun MVP Technical Plan

## Overview
This plan outlines the technical implementation for the FulQrun MVP - a sales operations platform that validates the core value proposition of PEAK + MEDDPICC embedded sales operations. The MVP will be built using Next.js 15 with TailwindCSS, Supabase for backend services, and Microsoft Graph integration, designed for rapid iteration and validation.

## Current Project State
- Next.js 15.5.2 with React (Vite)
- TailwindCSS v4 configured
- TypeScript setup
- Basic Next.js app structure in place

## Phase 1: Data Layer & Authentication

### 1.1 Supabase Setup & Schema Design
**Files to create/modify:**
- `supabase/migrations/` - Database migration files
- `src/lib/supabase.ts` - Supabase client configuration
- `src/types/database.ts` - TypeScript types for database schema

**Database Tables:**
- `organizations` - Company/tenant management
- `users` - User profiles with role-based access
- `contacts` - Contact management (light CRM)
- `companies` - Company/account management
- `leads` - Lead management with scoring
- `opportunities` - PEAK stage + MEDDPICC qualification
- `activities` - Email/calendar sync data
- `integrations` - Third-party service configurations

**Key Schema Features:**
- Row-level security (RLS) for multi-tenancy
- PEAK stages: Prospecting, Engaging, Advancing, Key Decision
- MEDDPICC fields: Metrics, Economic Buyer, Decision Criteria, Decision Process, Paper Process, Identify Pain, Champion, Competition
- Lead scoring rules configuration
- Microsoft Graph integration metadata

### 1.2 Authentication System
**Files to create:**
- `src/lib/auth.ts` - Authentication utilities
- `src/components/auth/` - Login/logout components
- `src/middleware.ts` - Route protection
- `src/app/auth/` - Authentication pages

**Implementation:**
- Supabase Auth with Microsoft Entra ID SSO
- Role-based access control (rep, manager, admin)
- Session management and token refresh
- Protected route middleware

## Phase 2A: Core CRM Modules (Parallel Development)

### 2A.1 Contact & Company Management
**Files to create:**
- `src/app/contacts/` - Contact management pages
- `src/app/companies/` - Company management pages
- `src/components/contacts/` - Contact components
- `src/components/companies/` - Company components
- `src/lib/api/contacts.ts` - Contact API functions
- `src/lib/api/companies.ts` - Company API functions

**Features:**
- CRUD operations for contacts and companies
- Search and filtering
- Contact-company relationships
- Basic contact activity tracking

### 2A.2 Lead Management
**Files to create:**
- `src/app/leads/` - Lead management pages
- `src/components/leads/` - Lead components
- `src/lib/api/leads.ts` - Lead API functions
- `src/lib/scoring/` - Lead scoring algorithms

**Features:**
- Manual lead entry forms
- Lead scoring rules engine
- Lead status tracking
- Lead-to-opportunity conversion

### 2A.3 Opportunity Management
**Files to create:**
- `src/app/opportunities/` - Opportunity management pages
- `src/components/opportunities/` - Opportunity components
- `src/lib/api/opportunities.ts` - Opportunity API functions
- `src/components/forms/PEAKForm.tsx` - PEAK stage form
- `src/components/forms/MEDDPICCForm.tsx` - MEDDPICC qualification form

**Features:**
- PEAK stage management (Prospecting, Engaging, Advancing, Key Decision)
- MEDDPICC qualification tracking
- Opportunity pipeline visualization
- Deal value and probability tracking

## Phase 2B: Integrations & Analytics (Parallel Development)

### 2B.1 Microsoft Graph Integration
**Files to create:**
- `src/lib/integrations/microsoft-graph.ts` - Graph API client
- `src/lib/integrations/email-sync.ts` - Email synchronization
- `src/lib/integrations/calendar-sync.ts` - Calendar synchronization
- `src/components/integrations/MicrosoftSetup.tsx` - Integration setup

**Features:**
- Email sync from Exchange/Outlook
- Calendar event synchronization
- Contact import from Microsoft contacts
- OAuth 2.0 flow for Microsoft Graph

### 2B.2 QuickBooks Integration (Stubbed)
**Files to create:**
- `src/lib/integrations/quickbooks.ts` - QuickBooks API client (stubbed)
- `src/components/integrations/QuickBooksSetup.tsx` - Integration setup
- `src/lib/mocks/quickbooks.ts` - Mock data for testing

**Features:**
- Stubbed QuickBooks API integration
- Test account configurations
- Invoice data structure preparation
- Mock invoicing workflows

### 2B.3 Analytics Dashboard
**Files to create:**
- `src/app/dashboard/` - Dashboard pages
- `src/components/analytics/` - Analytics components
- `src/lib/analytics/` - Analytics calculation functions
- `src/components/charts/` - Chart components (using Chart.js or similar)

**Features:**
- Pipeline by stage visualization
- Deal conversion rate tracking
- Revenue forecasting
- Activity metrics

## Phase 3: Role-Based Dashboards & PWA

### 3.1 Role-Based Access
**Files to create:**
- `src/components/dashboards/RepDashboard.tsx` - Sales rep dashboard
- `src/components/dashboards/ManagerDashboard.tsx` - Manager dashboard
- `src/components/dashboards/AdminDashboard.tsx` - Admin dashboard
- `src/lib/permissions.ts` - Permission utilities

**Features:**
- Rep dashboard: Personal pipeline, activities, leads
- Manager dashboard: Team performance, pipeline overview
- Admin dashboard: System settings, user management, integrations

### 3.2 PWA Configuration
**Files to create:**
- `public/manifest.json` - PWA manifest
- `public/sw.js` - Service worker
- `src/app/layout.tsx` - PWA meta tags
- `next.config.ts` - PWA configuration

**Features:**
- Mobile-responsive design
- Offline capability
- App-like experience
- Push notifications (future)

## Phase 4: Development Infrastructure

### 4.1 CI/CD Pipeline
**Files to create:**
- `.github/workflows/deploy.yml` - GitHub Actions workflow
- `vercel.json` - Vercel configuration
- `supabase/config.toml` - Supabase configuration

**Features:**
- Automated deployment to Vercel
- Supabase database migrations
- Environment variable management
- Automated testing pipeline

### 4.2 Testing Framework
**Files to create:**
- `src/__tests__/` - Test directory
- `jest.config.js` - Jest configuration
- `src/lib/mocks/` - Mock data and functions
- `cypress/` - E2E testing setup

**Features:**
- Unit tests for business logic
- Integration tests for API endpoints
- Mock services for external integrations
- E2E tests for critical user flows

## Technical Architecture

### Frontend Stack
- **Framework:** Next.js 15 with App Router
- **Styling:** TailwindCSS v4
- **State Management:** React Context + useReducer
- **Forms:** React Hook Form + Zod validation
- **Charts:** Chart.js or Recharts
- **UI Components:** Custom components with TailwindCSS

### Backend Stack
- **Database:** Supabase PostgreSQL
- **Authentication:** Supabase Auth + Microsoft Entra ID
- **API:** Supabase Edge Functions
- **File Storage:** Supabase Storage
- **Real-time:** Supabase Realtime subscriptions

### Integrations
- **Microsoft Graph:** Email, calendar, contacts
- **QuickBooks:** Invoicing (stubbed for MVP)
- **External APIs:** RESTful API patterns

### Development Tools
- **Code Generation:** Cursor + Claude for scaffolding
- **Type Safety:** TypeScript with generated types
- **Linting:** ESLint + Prettier
- **Testing:** Jest + Cypress
- **Deployment:** Vercel + Supabase

## Implementation Phases

### Phase 1: Foundation (Week 1)
1. Supabase project setup and schema creation
2. Authentication system implementation
3. Basic UI component library setup
4. Development environment configuration

### Phase 2: Core Features (Weeks 2-3)
1. Contact and company management (2A.1)
2. Lead management with scoring (2A.2)
3. Opportunity management with PEAK/MEDDPICC (2A.3)
4. Microsoft Graph integration (2B.1)
5. Basic analytics dashboard (2B.3)

### Phase 3: Polish & PWA (Week 4)
1. Role-based dashboards
2. PWA configuration
3. Mobile responsiveness
4. QuickBooks integration stubs

### Phase 4: Production Ready (Week 5)
1. CI/CD pipeline setup
2. Testing framework implementation
3. Performance optimization
4. Security hardening

## Key Algorithms

### Lead Scoring Algorithm
1. **Data Collection:** Gather lead attributes (source, company size, industry, etc.)
2. **Rule Engine:** Apply configurable scoring rules
3. **Weighted Calculation:** Calculate total score based on rule weights
4. **Threshold Management:** Categorize leads (hot, warm, cold)
5. **Auto-qualification:** Convert high-scoring leads to opportunities

### PEAK Stage Progression
1. **Prospecting:** Initial contact and qualification
2. **Engaging:** Active communication and relationship building
3. **Advancing:** Solution presentation and negotiation
4. **Key Decision:** Final decision and closing

### MEDDPICC Qualification Process
1. **Metrics:** Quantify the business impact
2. **Economic Buyer:** Identify decision maker
3. **Decision Criteria:** Understand evaluation process
4. **Decision Process:** Map the approval workflow
5. **Paper Process:** Document requirements
6. **Identify Pain:** Understand pain points
7. **Champion:** Find internal advocate
8. **Competition:** Assess competitive landscape

## Success Metrics
- User authentication and onboarding completion
- Lead-to-opportunity conversion rate
- PEAK stage progression tracking
- MEDDPICC qualification completeness
- Microsoft Graph integration functionality
- Mobile responsiveness across devices
- System performance and reliability

This plan provides a comprehensive technical roadmap for building the FulQrun MVP while maintaining focus on rapid iteration and validation of the core value proposition.
